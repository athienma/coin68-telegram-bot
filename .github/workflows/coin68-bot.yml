name: Coin68 Telegram Bot

on:
  schedule:
    - cron: '*/30 * * * *'
  workflow_dispatch:

permissions:
  contents: read

jobs:
  send-news:
    runs-on: ubuntu-latest
    timeout-minutes: 5
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v3

    - name: Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.10'

    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        pip install requests beautifulsoup4 lxml

    - name: Debug - List files and check script
      run: |
        echo "📁 Current directory:"
        pwd
        echo "📄 Files:"
        ls -la
        echo "🔍 Check Python script syntax:"
        python -m py_compile coin68_bot.py || echo "❌ Syntax error!"
        echo "📋 First few lines of script:"
        head -20 coin68_bot.py

    - name: Run Telegram Bot with debug
      env:
        BOT_TOKEN: ${{ secrets.BOT_TOKEN }}
        CHAT_ID: ${{ secrets.CHAT_ID }}
        GIST_TOKEN: ${{ secrets.GIST_TOKEN }}
        GIST_ID: ${{ secrets.GIST_ID }}
      run: |
        echo "🧪 Testing Python script..."
        # Chạy thử với debug
        python -c "
        import sys
        print('Python path:', sys.path)
        try:
            import requests
            print('✅ requests installed')
        except ImportError as e:
            print('❌ requests missing:', e)
        try:
            import beautifulsoup4
            print('✅ beautifulsoup4 installed')
        except ImportError as e:
            print('❌ beautifulsoup4 missing:', e)
        "
        
        echo "🚀 Running main script..."
        python coin68_bot.py
